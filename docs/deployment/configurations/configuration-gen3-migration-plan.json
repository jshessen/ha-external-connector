{
    "Version": "2012-10-17",
    "ConfigurationConsistencyPlan": {
        "GenerationSupport": {
            "Gen1_BackwardsCompatibility": {
                "description": "Smart Home Bridge legacy paths for backward compatibility",
                "paths": [
                    "/alexa/auth/appConfig",
                    "/ha-alexa/appConfig"
                ],
                "format": "ConfigParser",
                "deprecation": "Maintain for existing deployments"
            },
            "Gen2_TransitionPaths": {
                "description": "OAuth Gateway transition paths for enhanced security",
                "paths": [
                    "/homeassistant/alexa/config/oauth_config",
                    "/homeassistant/alexa/config/cloudflare_config",
                    "/homeassistant/alexa/config/ha_config"
                ],
                "format": "JSON SecureString",
                "deprecation": "Migrate to Gen3 structure"
            },
            "Gen3_StandardizedPaths": {
                "description": "Unified configuration structure for all Lambda functions",
                "paths": [
                    "/home-assistant/alexa/core/base-config",
                    "/home-assistant/alexa/oauth/gateway-config",
                    "/home-assistant/alexa/oauth/cloudflare-config",
                    "/home-assistant/alexa/smart-home/bridge-config",
                    "/home-assistant/alexa/security/rate-limiting",
                    "/home-assistant/alexa/performance/optimization"
                ],
                "format": "JSON SecureString with versioning",
                "implementation": "Primary configuration source"
            }
        }
    },
    "Statement": [
        {
            "Sid": "LambdaCrossInvocationAccess",
            "Effect": "Allow",
            "Action": [
                "lambda:InvokeFunction",
                "lambda:InvokeAsync",
                "lambda:GetFunction",
                "lambda:GetFunctionConfiguration",
                "lambda:ListFunctions"
            ],
            "Resource": [
                "arn:aws:lambda:us-east-1:719118582283:function:HomeAssistant",
                "arn:aws:lambda:us-east-1:719118582283:function:CloudFlare-Wrapper",
                "arn:aws:lambda:us-east-1:719118582283:function:ConfigurationManager"
            ],
            "Condition": {
                "StringEquals": {
                    "lambda:FunctionTag/Project": "HomeAssistant-External-Connector"
                }
            }
        },
        {
            "Sid": "DynamoDBConfigCacheManagement",
            "Effect": "Allow",
            "Action": [
                "dynamodb:CreateTable",
                "dynamodb:DescribeTable",
                "dynamodb:UpdateTable",
                "dynamodb:GetItem",
                "dynamodb:PutItem",
                "dynamodb:UpdateItem",
                "dynamodb:DeleteItem",
                "dynamodb:Query",
                "dynamodb:Scan",
                "dynamodb:BatchGetItem",
                "dynamodb:BatchWriteItem",
                "dynamodb:DescribeTimeToLive",
                "dynamodb:UpdateTimeToLive"
            ],
            "Resource": [
                "arn:aws:dynamodb:us-east-1:719118582283:table/ha-external-connector-config-cache",
                "arn:aws:dynamodb:us-east-1:719118582283:table/ha-external-connector-config-cache/index/*",
                "arn:aws:dynamodb:us-east-1:719118582283:table/ha-external-connector-oauth-cache",
                "arn:aws:dynamodb:us-east-1:719118582283:table/ha-external-connector-oauth-cache/index/*"
            ]
        },
        {
            "Sid": "SSMParameterStoreAccessAllGenerations",
            "Effect": "Allow",
            "Action": [
                "ssm:GetParameter",
                "ssm:GetParameters",
                "ssm:GetParametersByPath",
                "ssm:DescribeParameters",
                "ssm:PutParameter",
                "ssm:DeleteParameter"
            ],
            "Resource": [
                "arn:aws:ssm:us-east-1:719118582283:parameter/alexa/*",
                "arn:aws:ssm:us-east-1:719118582283:parameter/ha-alexa/*",
                "arn:aws:ssm:us-east-1:719118582283:parameter/homeassistant/*",
                "arn:aws:ssm:us-east-1:719118582283:parameter/home-assistant/*"
            ]
        },
        {
            "Sid": "CloudWatchLogsAndMetrics",
            "Effect": "Allow",
            "Action": [
                "logs:CreateLogGroup",
                "logs:CreateLogStream",
                "logs:PutLogEvents",
                "logs:DescribeLogGroups",
                "logs:DescribeLogStreams",
                "cloudwatch:PutMetricData",
                "cloudwatch:GetMetricStatistics",
                "cloudwatch:ListMetrics"
            ],
            "Resource": [
                "arn:aws:logs:us-east-1:719118582283:log-group:/aws/lambda/ConfigurationManager:*",
                "arn:aws:logs:us-east-1:719118582283:log-group:/aws/lambda/HomeAssistant:*",
                "arn:aws:logs:us-east-1:719118582283:log-group:/aws/lambda/CloudFlare-Wrapper:*",
                "*"
            ]
        },
        {
            "Sid": "KMSDecryptionForSSM",
            "Effect": "Allow",
            "Action": [
                "kms:Decrypt",
                "kms:DescribeKey"
            ],
            "Resource": [
                "arn:aws:kms:us-east-1:719118582283:key/*"
            ],
            "Condition": {
                "StringEquals": {
                    "kms:ViaService": [
                        "ssm.us-east-1.amazonaws.com",
                        "dynamodb.us-east-1.amazonaws.com"
                    ]
                }
            }
        },
        {
            "Sid": "CrossLambdaWarmingOptimization",
            "Effect": "Allow",
            "Action": [
                "lambda:GetProvisionedConcurrencyConfig",
                "lambda:ListProvisionedConcurrencyConfigs",
                "lambda:GetAlias",
                "lambda:ListAliases"
            ],
            "Resource": [
                "arn:aws:lambda:us-east-1:719118582283:function:HomeAssistant:*",
                "arn:aws:lambda:us-east-1:719118582283:function:CloudFlare-Wrapper:*"
            ]
        }
    ]
}
